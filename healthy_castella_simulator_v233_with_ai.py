# å¥åº·é•·å´è›‹ç³•è„†é¤…æ¨¡æ“¬å™¨ v2.3.3ï¼ˆå«AIå»ºè­°æ¨¡çµ„ï¼‰
# ä½¿ç”¨ Streamlit å¯åŸ·è¡Œï¼Œè¼¸å…¥é…æ–¹ç™¾åˆ†æ¯”ï¼Œè‡ªå‹•ç”¢å‡ºç‡Ÿé¤Šæ¨™ç¤ºèˆ‡ AI é…æ–¹å„ªåŒ–å»ºè­°

import streamlit as st
import pandas as pd

# === åŸæ–™è³‡æ–™åº«ï¼ˆæ¯100gç‡Ÿé¤Šå€¼ï¼Œéƒ¨åˆ†ç°¡åŒ–ç‰ˆï¼‰ ===
ingredient_db = {
    "æ¶²è›‹ç™½": {"ç†±é‡": 52, "è›‹ç™½è³ª": 10.5, "è„‚è‚ª": 0.2, "ç¢³æ°´": 0.7, "ç³–": 0.7, "éˆ‰": 166},
    "æ¶²è›‹é»ƒ": {"ç†±é‡": 322, "è›‹ç™½è³ª": 15.9, "è„‚è‚ª": 26.5, "ç¢³æ°´": 3.6, "ç³–": 0.6, "éˆ‰": 48},
    "å¤§è±†è›‹ç™½": {"ç†±é‡": 400, "è›‹ç™½è³ª": 88.0, "è„‚è‚ª": 3.0, "ç¢³æ°´": 1.0, "ç³–": 0.5, "éˆ‰": 100},
    "ä¹³æ¸…è›‹ç™½": {"ç†±é‡": 370, "è›‹ç™½è³ª": 80.0, "è„‚è‚ª": 1.0, "ç¢³æ°´": 8.0, "ç³–": 5.0, "éˆ‰": 200},
    "ç²¾è£½ç´°ç ‚": {"ç†±é‡": 387, "è›‹ç™½è³ª": 0.0, "è„‚è‚ª": 0.0, "ç¢³æ°´": 100.0, "ç³–": 100.0, "éˆ‰": 0},
    "å¤šå¯¡ç³–æ¼¿ HM85": {"ç†±é‡": 310, "è›‹ç™½è³ª": 0.0, "è„‚è‚ª": 0.0, "ç¢³æ°´": 77.0, "ç³–": 68.0, "éˆ‰": 20},
    "è‡ªä¾†æ°´": {"ç†±é‡": 0, "è›‹ç™½è³ª": 0, "è„‚è‚ª": 0, "ç¢³æ°´": 0, "ç³–": 0, "éˆ‰": 0},
    "çµ±ä¸€éºµç²‰": {"ç†±é‡": 360, "è›‹ç™½è³ª": 10.0, "è„‚è‚ª": 1.0, "ç¢³æ°´": 76.0, "ç³–": 1.5, "éˆ‰": 2},
    "ç„¡é‹æ³¡æ‰“ç²‰": {"ç†±é‡": 100, "è›‹ç™½è³ª": 0, "è„‚è‚ª": 0, "ç¢³æ°´": 25.0, "ç³–": 0.0, "éˆ‰": 10000},
    "ç©€ç‰©å¥¶ç²‰": {"ç†±é‡": 500, "è›‹ç™½è³ª": 12.0, "è„‚è‚ª": 25.0, "ç¢³æ°´": 55.0, "ç³–": 30.0, "éˆ‰": 250},
    "èµ¤è—»ç³–é†‡": {"ç†±é‡": 0, "è›‹ç™½è³ª": 0, "è„‚è‚ª": 0, "ç¢³æ°´": 100.0, "ç³–": 0.0, "éˆ‰": 0},
    "ä¹³é…ªç²‰": {"ç†±é‡": 500, "è›‹ç™½è³ª": 30.0, "è„‚è‚ª": 35.0, "ç¢³æ°´": 20.0, "ç³–": 5.0, "éˆ‰": 800},
    "ä¸‰åˆåŠ›9285": {"ç†±é‡": 200, "è›‹ç™½è³ª": 0.0, "è„‚è‚ª": 0.0, "ç¢³æ°´": 50.0, "ç³–": 0.0, "éˆ‰": 5000},
    "å¸•ç‘ªæ£®èµ·å£«ç²‰": {"ç†±é‡": 475, "è›‹ç™½è³ª": 42.0, "è„‚è‚ª": 33.0, "ç¢³æ°´": 5.0, "ç³–": 1.0, "éˆ‰": 1500},
}

st.title("ğŸ§ å¥åº·é•·å´è›‹ç³•è„†é¤…é…æ–¹æ¨¡æ“¬å™¨ v2.3.3")
st.markdown("è¼¸å…¥å„åŸæ–™æ¯”ä¾‹ï¼ˆç¸½å’Œéœ€ç‚º100%ï¼‰ï¼Œç³»çµ±å°‡è‡ªå‹•æ¨¡æ“¬æ¯ä»½ï¼ˆ25gï¼‰ç‡Ÿé¤Šæ¨™ç¤ºä¸¦æä¾› AI æ”¹è‰¯å»ºè­°")

with st.form("é…æ–¹è¼¸å…¥"):
    default_recipe = {
        "æ¶²è›‹ç™½": 20.5, "æ¶²è›‹é»ƒ": 6.2, "å¤§è±†è›‹ç™½": 2.0, "ä¹³æ¸…è›‹ç™½": 6.5,
        "ç²¾è£½ç´°ç ‚": 15.0, "å¤šå¯¡ç³–æ¼¿ HM85": 2.5, "è‡ªä¾†æ°´": 18.8, "çµ±ä¸€éºµç²‰": 4.5,
        "ç„¡é‹æ³¡æ‰“ç²‰": 0.6, "ç©€ç‰©å¥¶ç²‰": 5.7, "èµ¤è—»ç³–é†‡": 6.0, "ä¹³é…ªç²‰": 6.5,
        "ä¸‰åˆåŠ›9285": 0.2, "å¸•ç‘ªæ£®èµ·å£«ç²‰": 5.5
    }
    input_recipe = {}
    total = 0
    for ing, val in default_recipe.items():
        input_recipe[ing] = st.number_input(ing, value=val, step=0.1)
        total += input_recipe[ing]
    submit = st.form_submit_button("åŸ·è¡Œæ¨¡æ“¬")

if submit:
    if abs(total - 100) > 0.01:
        st.error(f"é…æ–¹ç¸½å’Œç‚º {total:.2f}%ï¼Œè«‹èª¿æ•´è‡³100%")
    else:
        df = pd.DataFrame(columns=["é …ç›®", "æ¯25g å«é‡", "æ¯100g å«é‡"])
        result_25g = {"ç†±é‡": 0, "è›‹ç™½è³ª": 0, "è„‚è‚ª": 0, "ç¢³æ°´": 0, "ç³–": 0, "éˆ‰": 0}
        for ing, pct in input_recipe.items():
            ref = ingredient_db[ing]
            for key in result_25g:
                result_25g[key] += ref[key] * (pct / 100) * 0.25  # æ¯25g

        for key in result_25g:
            df.loc[len(df)] = [key, f"{result_25g[key]:.2f}", f"{result_25g[key]*4:.2f}"]

        st.subheader("ğŸ“Š é ä¼°ç‡Ÿé¤Šæ¨™ç¤º")
        st.dataframe(df)

        st.subheader("ğŸ¤– AI æ”¹è‰¯å»ºè­°")
        suggestions = []
        if result_25g["è›‹ç™½è³ª"] < 5.0:
            suggestions.append("â¡ å»ºè­°æå‡æ¶²è›‹ç™½æˆ–ä¹³æ¸…è›‹ç™½æ¯”ä¾‹ï¼Œä»¥é”é«˜è›‹ç™½è¨´æ±‚ï¼ˆâ‰¥5gï¼‰")
        if result_25g["ç³–"] > 5.0:
            suggestions.append("â¡ å¯å†é™ä½ç ‚ç³–æ¯”ä¾‹ï¼Œä¸¦æé«˜èµ¤è—»ç³–é†‡æˆ–å¥¶ç²‰è£œç”œé¦™")
        if result_25g["ç¢³æ°´"] > 10.0:
            suggestions.append("â¡ æ¸›å°‘éºµç²‰æˆ–ç³–æ¼¿ä½¿ç”¨æ¯”ä¾‹ï¼Œä»¥æ§åˆ¶ç¸½ç¢³æ°´ <10g")
        if result_25g["è„‚è‚ª"] > 3.5:
            suggestions.append("â¡ è„‚è‚ªç•¥é«˜ï¼Œæª¢è¦–æ˜¯å¦å¯æ¸›å°‘è›‹é»ƒæˆ–ä¹³é…ªç²‰æ¯”ä¾‹")
        if not suggestions:
            suggestions.append("ğŸ‰ é…æ–¹ç‡Ÿé¤Šç´ è¡¨ç¾è‰¯å¥½ï¼Œç„¡éœ€é‡å¤§èª¿æ•´ï¼Œå¯é€²å…¥å¯¦é©—æ‰“æ¨£éšæ®µï¼")

        for s in suggestions:
            st.markdown(f"- {s}")
